.. _kafka-connect-migration:

==========================
Migrate from Kafka Connect
==========================

.. default-domain:: mongodb

Follow the steps in this guide to migrate your Kafka deployments from
`Kafka Connect <https://github.com/hpgrahsl/kafka-connect-mongodb>`_ to the
`official MongoDB Kafka connector <https://github.com/mongodb/mongo-kafka>`_.

Update Configuration Settings
-----------------------------

- Replace any property values that refer to ``at.grahsl.kafka.connect.mongodb``
  with ``com.mongodb.kafka.connect``.

- Replace ``MongoDbSinkConnector`` with ``MongoSinkConnector`` as the
  value of the ``connector.class`` key.

- Remove the "``mongodb.``" prefix from all configuration property key
  names.

- Remove the ``document.id.strategies`` key if it exists. If the value of
  this field contained references to any custom strategies, move them to the
  ``document.id.strategy`` field and read the :ref:`custom-class-changes`
  section for additional required changes to your classes.

- Replace any keys that were used to specify per-topic and collection
  overrides that contain the ``mongodb.collection`` prefix with the
  equivalent key in `Topic-Specific Configuration Settings
  <https://github.com/mongodb/mongo-kafka/blob/master/docs/sink.md#topic-specific-configuration-settings>`_.

.. _custom-class-changes:

Update Custom Classes
---------------------

If you added any classes or custom logic to your Kafka Connect connector,
migrate them to the new MongoDB Kafka connector jar file and make the
following changes to them:

- Update imports that refer to ``at.grahsl.kafka.connect.mongodb`` to
  ``com.mongodb.kafka.connect``.

- Replace references to the ``MongoDbSinkConnector`` class with
  ``MongoSinkConnector``.

- Update custom sink strategy classes to implement the
  ``com.mongodb.kafka.connect.sink.processor.id.strategy.IdStrategy``
  interface.

- Update references to the ``MongoDbSinkConnectorConfig`` class which
  has been split into the `sink.MongoSinkConfig
  <https://github.com/mongodb/mongo-kafka/blob/master/src/main/java/com/mongodb/kafka/connect/sink/MongoSinkConfig.java>`_
  and `sink.MongoSinkTopicConfig
  <https://github.com/mongodb/mongo-kafka/blob/master/src/main/java/com/mongodb/kafka/connect/sink/MongoSinkTopicConfig.java>`_
  classes.

Update PostProcessor Subclasses
-------------------------------

- Update any concrete methods that override methods in the Kafka Connect
  ``PostProcessor`` class to match the new method signatures of the
  MongoDB Kafka Connector `PostProcessor
  <https://github.com/mongodb/mongo-kafka/blob/master/src/main/java/com/mongodb/kafka/connect/sink/processor/PostProcessor.java>`_
  class.
